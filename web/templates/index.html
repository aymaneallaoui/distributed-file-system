<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Distributed File System</title>
    <script src="https://unpkg.com/htmx.org"></script>
    <script>
      function startDownload(filename) {
        const ws = new WebSocket(
          `ws://${window.location.host}/progress/${filename}`
        );
        ws.onmessage = function (event) {
          const progress = document.getElementById(`progress-${filename}`);
          progress.innerHTML = event.data;
          progress.style.display = "block";
        };
        ws.onclose = function () {
          const progress = document.getElementById(`progress-${filename}`);
          progress.innerHTML = "Download complete";
        };
        // Start the file download
        window.location.href = `/download/${filename}`;
      }
    </script>
  </head>
  <body>
    <h1>Distributed File System</h1>
    <!-- Upload Form -->
    <form hx-post="/upload" enctype="multipart/form-data" method="post">
      <input type="file" name="file" />
      <button type="submit">Upload</button>
    </form>
    <h2>Files</h2>
    <ul>
      {{range .files}}
      <li>
        {{.FileName}} -
        <a
          href="javascript:void(0);"
          onclick="startDownload('{{sanitize .FileName}}')"
          >Download</a
        >
        <div
          id="progress-{{sanitize .FileName}}"
          class="progress-bar"
          style="display: none"
        >
          Downloading...
        </div>
      </li>
      {{end}}
    </ul>
  </body>
</html>
